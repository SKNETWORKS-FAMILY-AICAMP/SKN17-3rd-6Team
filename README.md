# SKN17-3rd-Team6
> SK네트웍스 Family AI캠프 17기 - 3차 프로젝트 6팀  
  개발 기간: 2025.09.24 ~ 2025.09.25

<br>

# 🔖 Conents
1. [팀 소개](#1-팀-소개)
2. [프로젝트 개요](#2-프로젝트-개요)
3. [기술 스택 & 사용한 모델](#3-기술-스택과-모델)
4. [시스템 아키텍쳐](#4-시스템-아키텍처)
5. [WBS](#5-WBS)
6. [요구사항 명세서](#6-요구사항-명세서)
7. [수집한 데이터 및 전처리 요약](#7-데이터-및-전처리)
8. [DB 연동 구현 코드](#8-Vector-DB-연동)
9. [모델 선정 과정](#9-모델-선정-과정)
10. [테스트 계획](#10-테스트-계획-및-결과)
11. [프로그램 성능 개선 노력](#11-성능-개선-과정)
12. [수행 결과(테스트/시연 페이지)](#12-시연-페이지)
13. [한계점](#13-한계점)
14. [향후 개선 계획](#14-향후-개선-계획)
15. [한 줄 회고](#15-한-줄-회고)

<br>
<br>

# 1. 팀 소개
#### 팀명: 💡 RAGents
> RAG + AGents의 합성어. RAG를 활용해 사용자에게 최적화된 챗봇을 만드는 능력자들.
#### 프로젝트명: 🚗🔧 자동차 고장 및 이상현상 정비 챗봇 

### 팀 구성원
| 양정민 | 전상아 | 주수빈 | 최동현 |
|------------|------------|------------|------------|
| [@Yangmin](https://github.com/Yangmin3)| [@sang-a-le](https://github.com/sang-a-le) | [@Subin-Ju](https://github.com/Subin-Ju) | [@donghyun4957](https://github.com/donghyun4957) |


<br>
<br>


# 2. 프로젝트 개요
## 💡 프로젝트 소개
본 프로젝트는 현대/기아 **GSW 정비 매뉴얼**과 외부 데이터(네이버 블로그, 지식인)를 활용하여 차량 이상현상(진동, 소음, 경고등 등)에 대한 진단 및 **DIY 정비 가능 여부**를 안내하는 **Retrieval-Augmented Generation(RAG) 기반 챗봇**입니다.

<br>

## ✅ 프로젝트 필요성

| <img width="1304" height="874" alt="image" src="https://github.com/user-attachments/assets/151b78f2-3148-40f4-b826-b3c010cf9782" /> | <img width="1280" height="1180" alt="image" src="https://github.com/user-attachments/assets/2e8aa593-3542-41b9-a29a-0c85bc2f7820" /> |
|---------------------------|---------------------------|
|[소비자민원평가-자동차; AS에 민원 집중](https://www.consumernews.co.kr/news/articleView.html?idxno=739584) | [반복되는 엔진경고등에도 원인 못찾고 방치... 뒤늦게 고장 판정되면 시간ㆍ비용은 소비자 몫](https://www.consumernews.co.kr/news/articleView.html?idxno=739584) |

2025년 7월 기준, 대한민국 자동차 등록 수는 2천640만 8천대로 집계되었습니다. 대한민국 전체 인구의 절반 가량이 차량을 보유하고 있으며, 그 중 현대와 기아 자동차는 국산차 전체 판매 점유율의 92%를 차지하는 만큼 그 규모가 매우 큽니다.  

최대 판매 규모를 자랑하는 현대 자동차와 기아 자동차는 그 민원 처리 방식 역시 매우 훌륭하나, 그럼에도 불구하고 소비자들은 차량에 고장이 생겼을 경우 다음과 같은 세 가지 문제에 직면하게 됩니다.  
```
1. 고장 원인 진단 및 처리를 받았으나 정확한 원인을 알지 못하는 경우  
2. 고장 원인을 어느정도 알고 있으나 당장 서비스센터에 가야 하는지 그 심각성을 쉽게 짐작하기 어려운 경우  
3. 서비스 센터에서 고장 원인 조차 제대로 파악하지 못한 경우
```

저희의 챗봇은 이러한 문제를 겪고 있는 전국 약 2천 650만 명의 차량 보유자를 위해, 언제 어디서든 **쉽고 간편하게 고장 원인에 대해 일반 자동차 이용자도 파악할 수 있게 돕는** 챗봇을 만들게 되었습니다.  

세 가지 문제를 해결하기 위해, 저희 팀은 다음과 같이 챗봇을 개발하였습니다.  

- **블로그/지식인 크롤링 내용**을 통해 보다 다양한 차량 고장 관련 키워드의 정보를 학습하고  
- **현대자동차/기아자동차 공식 GSW 문서**를 통해 높은 신뢰도를 갖는 정확한 고장 원인 진단 및 해결 방법에 대해 안내할 수 있도록 하며
- 사용자가 서비스 센터에서 고장 진단 및 처리를 받을 시 **정확한 이해**를 돕고자 했습니다.

<br>

## 🎯 프로젝트 목표
- 사용자가 입력한 **이상현상 설명**을 기반으로 진단 수행
- **차종·엔진 스펙을 반영한 GSW 기반 표준 진단** + **외부 사용자 경험 데이터(블로그+지식인 크롤링) 결합**
- 사용자와의 대화를 통해 **중대한 문제 판단 및 정비소 방문 권고**

<br>
<br>

# 3. 기술 스택과 모델
| **Language✍️** | **Tools🪛** | **Embedding😄** | **Vector DB📚** | **LLM🤖** |**Serving Platform**| **FrameWork🪟** | **Demo💡** | **Collaborate🔧** |
|-------------------|----------------|---------------|---------------|-------------|-----------------|----------------|---------------|--------------|
| ![Python](https://img.shields.io/badge/-Python-3776AB?logo=python&logoColor=white) | ![VS Code](https://img.shields.io/badge/-VS%20Code-007ACC?logo=visualstudiocode&logoColor=white)<br> ![RunPod](https://img.shields.io/badge/-RunPod-5F43DC?logo=cloud&logoColor=white) | <sub><a href="https://huggingface.co/dragonkue/snowflake-arctic-embed-l-v2.0-ko">사용한 HF 모델</a></sub> | ![FAISS](https://img.shields.io/badge/-FAISS-009999?logo=meta&logoColor=white) |<sub><a href="https://huggingface.co/heegyu/EEVE-Korean-Instruct-10.8B-v1.0-GGUF">사용한 LLM 모델</a></sub> | ![Ollama](https://img.shields.io/badge/-Ollama-000000?logo=ollama&logoColor=white) | ![LangChain](https://img.shields.io/badge/-LangChain-F9AB00?logo=LangChain&logoColor=white)<br>![Hugging Face](https://img.shields.io/badge/-HuggingFace-FFD21F?logo=huggingface&logoColor=black) | ![Streamlit](https://img.shields.io/badge/-Streamlit-FF4B4B?logo=streamlit&logoColor=white) |  ![Discord](https://img.shields.io/badge/-Discord-5865F2?logo=discord&logoColor=white)<br> ![GitHub](https://img.shields.io/badge/-GitHub-181717?logo=github&logoColor=white) |


<br>
<br>

# 4. 시스템 아키텍처

```mermaid
flowchart LR
    subgraph Input
        A1[사용자 텍스트 입력] --> P1
    end

    subgraph Preprocessing
        P1[텍스트 전처리\n토큰화·차종 추출]
    end

    subgraph Retrieval
        R1[GSW 벡터DB\n차종·엔진 기반 1차 검색]
        R2[블로그/지식인 벡터DB\n키워드 기반 2차 검색]
    end

    subgraph RAG
        G1[검색 결과 통합]
        G2[LLM 기반 응답 생성]
    end

    Input --> Preprocessing
    Preprocessing --> Retrieval
    Retrieval --> RAG
    RAG --> Out[최종 답변 제공]

```
<br>

# 5. WBS
![WBS 이미지](./readme_image/WBS.png)

<br>
<br>

# 6. 요구사항 명세서
<img width="1408" height="754" alt="image" src="https://github.com/user-attachments/assets/a317911f-9946-44c6-8868-142b357f16c1" />

<br>
<br>

# 7. 데이터 및 전처리

## 📂 데이터 출처 및 구조화

### 1. 현대/기아 GSW (정비 매뉴얼)
![GSW 페이지 GIF](./readme_image/1.gif)
> PDF 정비지침서 → PDF파일 크롤링 → 텍스트 추출 → JSON 변환

- 단위: **고장진단 절차별 레코드**

- 메타데이터: ``차종``, ``엔진``, ``출처``

```json
"고장진단": [
  {
    "title": "보안 및 차량시동시스템+빌트인캠 영상 녹화 안 됨",
    "content": "퓨즈 단선/개조 확인, DVRS 고장 코드 점검, 모듈·카메라 점검",
    "type": "현대",
    "차종": "EV6(CV)",
    "엔진": "160KW+270KW(4WD)"
  }
]
```

### 2. 네이버 블로그
사용자 경험 데이터

AI로 요약한 본문 content 중심으로 **Chunk 단위 분할 및 임베딩**

```json
"문제 키워드": [
  {
    "title": "블로그 제목",
    "content": "블로그 내용",
    "type": "블로그",
    "출처": "https://blog.naver.com/example",
    "차종": null,
    "엔진": null
  }
]
```

### 3. 네이버 지식인
- Q&A 형식

- ``title(질문)`` + ``content(답변)``을 하나의 문서로 통합 후 임베딩

```json
"문제 키워드": [
  {
    "title": "질문",
    "content": ["답변1", "답변2"],
    "type": "지식인",
    "출처": "https://kin.naver.com/qna/example",
    "차종": null,
    "엔진": null
  }
]
```
<br>

## 🏭 데이터 전처리(1)
- 참고: 📁 text_preprocessing.py 

### 1. 표 형태로 되어있는 PDF 내용 처리
#### 1-1. "현상", "고장"이 표 안에 있는 경우
- **현대 자동차**  
"현상", "코드", "원인", "고장 현상", "점검 항목" 등 필요한 데이터가 표 안에 담겨있을 경우,  
해당 내용들을 표 안에서 index를 찾아 반환하는 형식으로 추출.

- **기아 자동차**  
필요한 데이터인 "현상', "코드", "원인" 내용이 표 안에 담겨있을 경우,  
해당 내용들을 표 안에서 index를 찾아 반환하는 형식으로 추출.  

#### 1-2. "현상", "고장"이 표 밖에 <소제목> 형태로 있는 경우
1. `page.find_tables()` 메서드를 활용하여 표를 찾아서 추출  
2. `table.bbox[1]`를 통해 표 안에서 좌표를 찾아 내용을 반환.  

### 2. "현상", "원인" 데이터 추출 이후
- 문제 상황: 딕셔너리 형태로 .json 파일에 저장하는 과정에서 동일한 "현상" 또는 "원인"이 반복되는 문제   
#### 2-1. "현상"이 여러 번 반복
- 동일한 "현상"이 반복해서 담길 수 있도록 for 구문 활용
#### 2-2. "원인"이 여러 개 등장
- 하나의 "현상"에 존재하는 여러 "원인"들을 [리스트] 형태로 반환

### 3. 차종-엔진 형식 통일
- 표에 있는 모든 내용 추출이 완료된 이후, 위의 코드를 통해 차종-엔진 형식을 통일하여 카테고리 추출을 최종 완료함.

### 4. 지정 형식으로 변환
`데이터 출처 및 구조화` 항목에서 지정한 데이터 형식으로 변환하기 위한 처리 진행.  
`title`, `content`, `type`, `차종`, `엔진` 각 항목에 올바른 데이터가 들어갈 수 있도록 코드 작업.  

### 5. 메타 데이터 merge
- 1~4번 작업을 거친 현대 자동차와 기아 자동차 GSW 데이터에 관한 `json` 파일들을 merge하는 과정을 거쳐 새로운 파일로 통합.  
→ Vector DB에 저장될 수 있는 형식으로 최종 변환


### 6. GSW 및 네이버 블로그/지식인 크롤링 데이터 전처리
```
# 텍스트 정리 
def clean_string(s: str) -> str:
    if not s:
        return ""
    # 유니코드 정규화 (호환 문자 통합)
    s = unicodedata.normalize("NFKC", str(s))
    # 알파벳, 한글, 숫자, 공백만 남기기
    s = re.sub(r"[^0-9a-zA-Z가-힣\s]+", " ", s)
    s = re.sub(r"\s+", " ", s)   # 여러 공백 → 하나의 공백
    return s.strip()             # 앞뒤 공백 제거
```
> 특히 이모티콘, 공백, 엔터 스페이스가 많은 크롤링 데이터 위주로 위와 같이 전처리

<br>

## 데이터 전처리(2) - 🔍 검색 및 임베딩 전략
### 1. 임베딩 단위
| 데이터 출처 | 임베딩 단위 |
|------------|-----------|
| **블로그** | 본문을 Chunk 분할 후 임베딩 |
| **지식인** | 질문(title)과 Chunk 분할된 답변(content) 통합 → 단일 벡터 임베딩 |
| **GSW** | 고장진단 단위 → 레코드 단위 임베딩 |


**Chunk 과정**
```
splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,
    chunk_overlap=50
)

```
- 본문 내용이 긴 블로그 글과, 여러 개의 답변이 있는 지식인 내용의 경우 `chunk_size=1000` 으로 지정하여 임베딩을 진행함.


### 2. 검색 우선순위

1. **1차 검색** : GSW 내부 문서 (차종·엔진 기반)

2. **2차 검색** : 블로그/지식인 크롤링 (차종·엔진 없음 → 공통 키워드 기반)

3. **최종 답변** : 두 검색 결과 통합 + 신뢰도 가중치 적용

<br>
<br>

# 8. Vector DB 연동
### 사용한 벡터 DB: FAISS
**FAISS 선택 이유**
1. 고성능 유사성 검색: 벡터 데이터에서 가장 가까운 이웃 벡터를 효과적으로 찾아내는 Nearest Neighbor Search 기능을 제공하므로 빠른 검색 효율을 내기에 적합.
2. GPU 지원을 통한 가속 연산: GPU 연결 시 병렬 연산이 지원되어 처리 속도를 크게 향상시킬 수 있음.
3. 다양한 인덱스 유형: 여러 인덱스 유형을 지원하여 데이터 크기와 요구에 맞는 최적화된 검색 성능을 제공함.
4. 대규모 데이터 처리 성능: 다른 Vector DB에 비해 대규모 고차원 벡터 데이터를 빠르게 처리할 수 있는 능력이 뛰어남.   
→ 전통적인 방법으로는 효율적으로 처리하기 어려운 대규모 데이터 처리에 매우 적합. (약 8만 개 + 이후 계속 확장할 예정)
5. 커뮤니티 지원 및 확장성: 많은 엔지니어들이 지속적으로 개선하고 있으므로 확장성ㆍ안정성 면에서 우위를 점하는 DB.

**벡터 DB 코드 및 파일**
- 📁 vector_store.py
- 🔗 [벡터 DB 구축(Google Drive)](https://drive.google.com/drive/folders/116zAgunFJb1ZxaShQKSVPMpM7oNylaXX?usp=sharing)

<br>
<br>

# 9. 모델 선정 과정
### 🤖선정 모델: `heegyu/EEVE-Korean-Instruct-10.8B-v1.0-GGUF`
  
**선정 과정**  
1. **모델 사용 목적**: GPU 서버를 아끼면서, 온디바이스에서 동작할 수 있는 챗봇 생성. 단, 응답 속도가 너무 느린 모델은 사용을 지양할 것.    
2. **sLM vs. sLLM**  

  | 모델 유형 | sLM |
  |--------------|-----------------|
  | 모델 특징 | 모바일에서도 동작하는 아주 경량화된 모델. 보통 1B-3B 사이의 크기를 가진 모델을 의미함.|
  | 모델 단점 | sLM을 고를 경우, 파라미터 수가 적다 보니 `Gemma3-4B` 모델처럼 성능이 잘 나오지 않을 수 있으며, 추론이 어렵다는 문제가 있음.|

> 경우, RAG(문서 입력 - 문서 요약 및 학습 - 쿼리 이해 후 답변 생성) 성능이 원하는 수준으로 나오기에는 부족한 파라미터 수를 갖고 있다는 생각이 듦.  
∴ 따라서 sLLM 모델을 사용하는 것으로 결정  

3. **sLLM 모델 선정**  
- 모델을 선정하기 위해 정해둔 최적 모델 선정 조건은 다음과 같다.  
  1. 모델 용량을 얼마나 받쳐줄 수 있는가?
  - 차량에 모델을 탑재하여 사용한다고 생각했을 때, 용량의 최소화가 가장 중요한 지점으로 작용할 것.
  - ecu(16GB)를 고려하여, 최대 처리 용량이 16GB 이하 + 가능하다면 안전하게 더 적은 메모리를 차지하는 모델을 선정할 것.
  - 16GB 내에서 가동함과 동시에, 경량화를 위해 10B 안에서 작동하는 sLLM 모델을 선정하기로 최종 결정
  2. 응답 정확도가 어느 정도 나오는가?
  3. 응답 속도가 어느 정도 나오는가?

위의 선정 과정을 바탕으로 모델을 뽑아, 테스트를 통해 성능을 검증하여 최종적으로 EEVE 모델을 선정함.

<br>
<br>

# 10. 테스트 계획 및 결과
## ✏️ 테스트 계획
| **정확도 항목** | **평가 항목** | **질문** | **의도**|
|---------------|------------------------|-----------------|--------------|
| **1** | 의성어, 의태어를 잘 인식하는지 | 1. 하부에서 그그극, 드르륵, 드드득 소리가 나.<br>2. 에어컨 필터가 덜렁거려. | 1. 해당 의성어를 '소음'으로 인식<br>2. 에어컨 필터가 떨어진 '현상'으로 인식 |
| **2** | 매뉴얼 내용을 잘 이해하고 요약해서 반환하는지 | - 길이 별 구분<br>1. kia 그랜드카니발(VQ)의 스티어링 시스템 일반사항 고장 진단법(572자)<br>2.kia K9(RJ)의 드라이브샤프트 및 액슬의 소음(197자)<br>3. Hyudai G80(RG3 EV)의 로어 페달 또는 스폰지 페달 고장진단(69자) | 상세한 차량 모델 및 증상을 반환했을 때 기존 매뉴얼 내용을 기본으로 요약된 내용 및 사용자 친화적 표현 방식으로 답변을 반환 |
| **3** | 꼬리질문에 대한 대응도 | 1. 브레이크가 밀리는 데 왜 그런거야? | 해당 질문 후 4) 항목에 대해 질문했을 때, 이전 질문 내용을 기억하고, 적절히 답변 |
| **4** | 사용자의 질문을 잘 이해하고 답변하는지 | 2. 브레이크 패드가 이상이 있는 것처럼 보여. 지금 바로 정비소에 가야 해? | 2. 정비소에 가야하는 지를 물어보는 질문에서 요점을 파악하고, 브레이크 패드에 대한 설명이 아닌 정비소 방문 여부에 대해 반환 |

<br>

## 📑 테스트 결과

<br>
<br>

# 11. 성능 개선 과정
## ⚠️ 기술적 고려사항
1. **신뢰도 가중치**
- GSW > 지식인 > 블로그 순
- 외부 데이터는 신뢰도 평가 지표 필요 (예: 답변 채택 여부, 댓글 반응 등)

2. **데이터 불균형**
- 블로그/지식인 ≫ GSW → GSW 기반 검색 우선 적용
- 메타데이터 필터링 강화로 차량별 매칭 정확도 확보


3. **키워드 크롤링 한계**
- 자동차 무관 데이터 혼입 → 사전 필터링 필요
- 불필요 키워드 자동 제거 로직 포함

<br>

## 🚀 기대 효과
운전자: 정비소 방문 전 **자가 진단 가능**

정비 효율: **문제 사전 파악 → 불필요 방문 감소**

데이터적 측면: **기업 매뉴얼 + 사용자 경험 데이터 융합**

기술적 확장성: **추후 다른 브랜드 차량 GSW·포럼 데이터로 확장 가능**

<br>
<br>

# 12. 시연 페이지
![시연 페이지1](./readme_image/streamlit1.png)
![시연 페이지2](./readme_image/streamlit2.png)
![시연 페이지3](./readme_image/streamlit3.png)

<br>
<br>

# 13. 한계점
- 경량 모델을 선정하고자 하였지만 약 10b 모델 선정
- 온디바이스 테스트 부족
- 블로그, 지식인 크롤링 과정에서 거르지 못한 무관한 글
- 기업 내부문서의 모든 차종 엔진유형에 대한 문서 추출 한계

<br>
<br>

# 14. 향후 개선 계획
### 파인튜닝 진행
- 진행 상황: 3차 프로젝트 진행 과정 중에 파인튜닝을 진행하지 않고 RAG까지만 진행하여 모델 학습 및 성능 테스트를 진행함.
- 진행 계획: sLLM 모델 파인튜닝을 통해 프롬프트 엔지니어링만으로 해결하기 어려웠던 문제들을 개선하고, 기존에 Vector DB에 저장한 내부 문서 및 크롤링 데이터를 활용해 '자동차 고장진단' 도메인에서 최적의 성능을 발휘하도록 조정할 것.

### 벡터 DB 개선
- 주제와 무관한 데이터 삭제: 블로그, 지식인 크롤링 과정에서 키워드 및 도메인과 무관한 내용의 글을 전부 거를 수 있도록 수정.
- 전처리 과정 고도화 작업 필요: 현대 자동차/기아 자동차 GSW 문서 임베딩 과정에서 "현상"과 "원인"을 단순 공백으로 연결 → 모델이 "현상"과 "원인"을 좀 더 잘 연결지어 이해할 수 있도록 임베딩 과정을 개선하여 벡터 DB를 발전시킬 예정.

### RAG 성능 향상: 리랭커
- 질문과 문서를 함께 분석하는 크로스-인코더(Cross-Encoder) 방식을 통해 질문과 Vector DB 문서 간의 상호작용을 직접적으로 분석하고, hallucination 현상을 대폭 감소시켜 같은 모델을 사용하더라도 더 높은 응답 정확성을 낼 수 있도록 수정할 계획.

### 경량 모델 추가 테스트
- 현재 사용중인 EEVE 모델의 10.8B 보다 경량화된 모델이 우수한 성능을 낼 수 있는지 추가 테스트를 진행할 예정
  - 만약 10.8B보다 경량화된 모델이 현재 모델만큼 성능이 우수하다면: CoT 를 진행
  - 만약 10.8B보다 경량화된 모델이 현재 모델보다 성능이 우수하지 않다면: CoT를 진행하기에 파라미터가 부족하다고 판단 → Conditional Chain을 생성하는 방식으로 변경하여 테스트하는 방법 고려

<br>
<br>

# 15. 한 줄 회고
- 양정민 : 
- 전상아 :
- 주수빈 : 
- 최동현 :
